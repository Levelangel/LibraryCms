@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
</head>
<body>
    <div class="container">
        <div class="row">
            <h2>
                AJAX异步方式-上传文件
            </h2>
            @using (Html.BeginForm("AjaxUpload", "Test", FormMethod.Post, new { id = "uploadForm", @class = "form-horizontal", enctype = "multipart/form-data" }))
            {
                <div class="form-group">
                    <label for="file">
                        选择文件
                    </label>
                    <input id="file" name="file" type="file" />
                </div>
                <div class="form-group">
                    <label for="filename">
                        文件名
                    </label>
                    <input id="filename" name="filename" class="form-control" placeholder="请输入要上传的文件名"
                           type="text" />
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-info">
                        上传
                    </button>
                </div>
            }
        </div>
        <div class="row">
            <div class="progress">
                <div class="bar">
                </div>
                <div class="percent">
                    0%
                </div>
            </div>
            <div id="status">
            </div>
        </div>
    </div>
    @Scripts.Render("~/bundles/jquery")
    <script type="text/javascript">

        (function () {
            var bar = $('.bar');
            var percent = $('.percent');
            var status = $('#status');
            $('#uploadForm').on('submit', function (e) {
                e.preventDefault(); // <-- important
                $(this).ajaxSubmit({
                    beforeSend: function () {
                        status.empty();
                        var percentVal = '0%';
                        bar.width(percentVal);
                        percent.html(percentVal);
                    },
                    uploadProgress: function (event, position, total, percentComplete) {
                        var percentVal = percentComplete + '%';
                        bar.width(percentVal);
                        percent.html(percentVal);
                    },
                    success: function () {
                        var percentVal = '100%';
                        bar.width(percentVal);
                        percent.html(percentVal);
                    },
                    complete: function (xhr) {
                        status.html(xhr.responseText);
                    }
                });
            });
        })();
    </script>
</body>
</html>